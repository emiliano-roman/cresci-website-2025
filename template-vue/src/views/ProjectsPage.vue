<template>

  <!-- page content -->
  <div id="page-portfolio" class="padding-top-xlg-0 bg-dark">

  <div ref="portfolioSlider" class="cs-portfolio-slider" data-speed="1000" data-mousewheel="true" data-keyboard="true" data-simulate-touch="true" data-grab-cursor="false" data-pagination-type="bullets" >

      <!-- Begin swiper container -->
      <div class="swiper">

          <!-- Begin swiper wrapper (required) -->
          <div class="swiper-wrapper">


              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="/projects/campTurbo" data-title="CAMP TURBO" data-category="BRANDING" data-date="OCT 24" data-ol="01">
                <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                    <figure id="linkItem" data-href="/projects/CampTurbo" data-cursor-project="View Project">
                    <img src="projects/campTurbo.webp" data-src="projects/campTurbo.webp" alt="Crescis - Camp Turbo">
                    </figure>
                </div> <!-- /.cs-slider-item -->
              </div>
              <!-- End swiper slide -->


              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="https://cresci.co/willow/" data-title="WILLOW" data-category="STRATEGY | ANIMATION" data-date="JUL 23" data-ol="02">
                <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                    <figure id="linkItem" data-href="https://cresci.co/willow/" data-cursor-project="View Project">
                    <img src="projects/willow.webp" data-src="projects/willow.webp" alt="Crescis - Willow">
                    </figure>
                </div> <!-- /.cs-slider-item -->
              </div>
              <!-- End swiper slide -->


              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="https://cresci.co/salesforce/" data-title="SALESFORCE" data-category="STRATEGY | ANIMATION | EVENTS IN MOTION | UX/UI" data-date="JUL 23" data-ol="03">
                <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                    <figure id="linkItem" data-href="https://cresci.co/salesforce/" data-cursor-project="View Project">
                    <img src="projects/salesforce.webp" data-src="projects/salesforce.webp" alt="Crescis - Salesforce">
                    </figure>
                </div> <!-- /.cs-slider-item -->
              </div>
              <!-- End swiper slide -->

              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="/projects/Docusign24" data-title="DOCUSIGN 24" data-category="BRANDING | EVENTS IN MOTION | ANIMATION | UX/UI" data-date="JUL 23" data-ol="04">
                <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                    <figure id="linkItem" data-href="/projects/Docusign24" data-cursor-project="View Project">
                    <img src="projects/docusign24.webp" data-src="projects/docusign24.webp" alt="Crescis - Docusign">
                    </figure>
                </div> <!-- /.cs-slider-item -->
              </div>
              <!-- End swiper slide -->

              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="/projects/7Studio" data-title="7 STUDIO" data-category="STRATEGY | BRANDING" data-date="JUL 23" data-ol="05">
              <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                  <figure id="linkItem" data-href="/projects/7Studio" data-cursor-project="View Project">
                  <img src="projects/7-studio.webp" data-src="projects/7-studio.webp" alt="Crescis - 7Studio">
                  </figure>
              </div> <!-- /.cs-slider-item -->
              </div>
              <!-- End swiper slide -->

              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="/projects/Google" data-title="GOOGLE" data-category="ANIMATION" data-date="JUL 23" data-ol="06">
                  <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                      <figure id="linkItem" data-href="/projects/Google" data-cursor-project="View Project">
                        <img src="projects/google.webp" data-src="projects/google.webp" alt="Crescis - Google">
                      </figure>
                  </div> <!-- /.cs-slider-item -->
              </div> 
              <!-- End swiper slide -->


              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="/projects/DpWorld" data-title="DP WORLD" data-category="ANIMATION | EVENTS IN MOTION"   data-date="JUL 23" data-ol="07">
                <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                    <figure id="linkItem" data-href="/projects/DpWorld" data-cursor-project="View Project">
                    <img src="projects/dpworld.webp" data-src="projects/dpworld.webp" alt="Crescis - Dp World">
                    </figure>
                </div> <!-- /.cs-slider-item -->
              </div>
              <!-- End swiper slide -->


              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="/projects/Synapse" data-title="SYNAPSE" data-category="STRATEGY | BRANDING" data-date="JUL 23" data-ol="08">
                  <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                      <figure id="linkItem" data-href="/projects/Synapse" data-cursor-project="View Project">
                        <img src="projects/synapse.webp" data-src="projects/synapse.webp" alt="Crescis - Synapse">
                      </figure>
                  </div> <!-- /.cs-slider-item -->
              </div> 
              <!-- End swiper slide -->


              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="/projects/Docusign23" data-title="DOCUSIGN 23’" data-category="STRATEGY | ANIMATION | EVENTS IN MOTION | UX/UI" data-date="JUL 23" data-ol="09">
                  <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                      <figure id="linkItem" data-href="/projects/Docusign23" data-cursor-project="View Project">
                        <img src="projects/docusign23.webp" data-src="projects/docusign23.webp" alt="Crescis - Docusign">
                      </figure>
                  </div> <!-- /.cs-slider-item -->
              </div> 
              <!-- End swiper slide -->


              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="/projects/Penta" data-title="PENTA" data-category="STRATEGY | BRANDING | ANIMATION" data-date="JUL 23" data-ol="10">
              <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                  <figure id="linkItem" data-href="/projects/Penta" data-cursor-project="View Project">
                  <img src="projects/penta.webp" data-src="projects/penta.webp" alt="Crescis - Penta">
                  </figure>
              </div> <!-- /.cs-slider-item -->
              </div>
              <!-- End swiper slide -->


              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="/projects/TheSandbox" data-title="THE SANDBOX" data-category="BRANDING | ANIMATION" data-date="JUL 23" data-ol="11">
                  <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                      <figure id="linkItem" data-href="/projects/TheSandbox" data-cursor-project="View Project">
                        <img src="projects/thesandbox.webp" data-src="projects/thesandbox.webp" alt="Crescis - The Sandbox">
                      </figure>
                  </div> <!-- /.cs-slider-item -->
              </div> 
              <!-- End swiper slide -->


              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="/projects/Decoded" data-title="DECODED" data-category="ANIMATION | EVENTS IN MOTION" data-date="JUL 23" data-ol="12">
                  <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                      <figure id="linkItem" data-href="/projects/Decoded" data-cursor-project="View Project">
                        <img src="projects/decoded.webp" data-src="projects/decoded.webp" alt="Crescis - Decoded">
                      </figure>
                  </div> <!-- /.cs-slider-item -->
              </div> 
              <!-- End swiper slide -->


              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="/projects/OldGlory" data-title="OLD GLORY" data-category="ANIMATION | BRANDING | STRATEGY | UX/UI & DEVELOPMENT" data-date="JUL 23" data-ol="13">
                  <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                      <figure id="linkItem" data-href="/projects/OldGlory" data-cursor-project="View Project">
                        <img src="projects/oldglory.webp" data-src="projects/oldglory.webp" alt="Crescis - Old Glory">
                      </figure>
                  </div> <!-- /.cs-slider-item -->
              </div> 
              <!-- End swiper slide -->



              <!-- Begin swiper slide -->
              <div class="swiper-slide" data-url="/projects/17Sigma" data-title="17SIGMA" data-category="BRANDING | UX/UI DEVELOPMENT" data-date="JUL 23" data-ol="14">
                  <div class="cs-portfolio-slider-item" data-swiper-parallax="50%">
                      <figure id="linkItem" data-href="/projects/17Sigma" data-cursor-project="View Project">
                        <img src="projects/17Sigma.webp" data-src="projects/17Sigma.webp" alt="Crescis - 17Sigma">
                      </figure>
                  </div> <!-- /.cs-slider-item -->
              </div> 
              <!-- End swiper slide -->



          </div>
          <!-- End swiper wrapper -->

      </div>
      <!-- End swiper container -->
      
     
      <!-- Begin slider caption -->
      <div class="cs-portfolio-slider-caption psc-center">
          <div class="cs-ps-caption-inner">
              <h2 class="cs-psc-elem cs-ps-caption-title">
                  <span></span>
              </h2>
          </div> <!-- /.cs-ps-caption-inner -->
          <div class="cs-caption-ol">
              <h6 class="cs-psc-elem cs-ps-caption-ol"></h6>
          </div>
          <div class="cs-caption-category">
              <h3 class="cs-psc-elem cs-ps-caption-category"></h3>
          </div>
          <div class="cs-caption-date">
              <h5 class="cs-psc-elem cs-ps-caption-date"></h5>
          </div>
      </div>
      <!-- End slider caption -->

      <!-- Begin slider navigation -->
      <div class="cs-portfolio-slider-navigation cs-swiper-nav">
          <div class="cs-ps-nav-pagination"></div>
      </div>
      <!-- End slider navigation -->

  </div>
  <!-- End portfolio -->

  </div>
  <!-- End page content -->

</template>




<script>
/* eslint-disable */

import $ from 'jquery';
import { pageTransition, updateHeaderTheme, cursorMagic } from '../assets/js/scriptsApp.js';
import gsap, { Power1 } from 'gsap'; 
import { ScrollTrigger } from 'gsap/ScrollTrigger';
import 'swiper/swiper-bundle.css';
import Swiper from 'swiper';
import { Navigation, Pagination, Mousewheel, Keyboard } from 'swiper/modules';
Swiper.use([Navigation, Pagination, Mousewheel, Keyboard]);
gsap.registerPlugin(ScrollTrigger);

export default {
    mounted() {
    console.log("Componente montado, inicializando funciones...");
    pageTransition();
    // menuSite();
    //   navbarFix();
    updateHeaderTheme(); // actualizar el theme
    cursorMagic();
    this.initLinkAnimation(); 
    this.initPortfolioSlider(); 
    this.removeBodyClasses(); 
    this.removeContentColor(); 
    },
    methods: {
    initLinkAnimation() {
        const figures = document.querySelectorAll('#linkItem'); // Seleccionamos los elementos de los links
        const magicCursor = document.getElementById('magic-cursor');
        const body = document.body;

        // Manejar el evento de 'pageshow'
        window.addEventListener("pageshow", function (event) {
            if (event.persisted || sessionStorage.getItem("redirected") === "true") {
                sessionStorage.removeItem("redirected");
                body.style.visibility = "hidden";
                setTimeout(() => {
                    window.location.reload();
                }, 0);
            } else {
                body.style.visibility = "visible";
            }
        });

        figures.forEach(figure => {
            const href = figure.dataset.href;

            // Prefetch al hover
            figure.addEventListener('mouseenter', function () {
                console.log("Hover en el link:", figure); // Agregar aquí el console.log
                if (!document.querySelector(`link[rel="prefetch"][href="${href}"]`)) {
                    const link = document.createElement('link');
                    link.rel = 'prefetch';
                    link.href = href;
                    document.head.appendChild(link);
                }
                magicCursor.classList.add('hover'); // Agregar la clase hover al entrar
            });

            figure.addEventListener('mouseleave', function () {
                magicCursor.classList.remove('hover'); // Remover la clase hover al salir
            });

            figure.addEventListener('click', function () {

                // Si el href es un enlace externo, abrir en nueva pestaña
                if (href.startsWith('http')) {
                    window.open(href, '_blank');
                    return; // Salir para evitar ejecutar el resto del código
                }

                // Ocultar el cursor mágico y bloquear clics
                magicCursor.style.display = 'none';
                body.style.pointerEvents = 'none';

                const img = figure.querySelector('img');
                const titleH1 = figure.closest('.cs-portfolio-slider').querySelector('.cs-psc-elem');
                const titleH6 = figure.closest('.cs-portfolio-slider').querySelector('.cs-ps-caption-category');
                const titleDate = figure.closest('.cs-portfolio-slider').querySelector('.cs-ps-caption-date');
                const titleOl = figure.closest('.cs-portfolio-slider').querySelector('.cs-ps-caption-ol');

                // Comprobar si los elementos existen antes de animar
                if (img && titleH1 && titleH6 && titleDate && titleOl) {
                    // Animaciones
                    gsap.to([titleH6, titleH1, titleDate, titleOl], {
                        duration: 0.8,
                        y: 180,
                        opacity: 0,
                        stagger: 0.1,
                        ease: "power4.inOut"
                    });

                    gsap.to(img, {
                        delay: 0.3,
                        duration: 1,
                        scale: 1.1,
                        ease: "power4.inOut"
                    });

                    figure.style.clipPath = 'inset(0 0 0 0)';

                    setTimeout(() => {
                        gsap.to(figure, {
                            duration: 1,
                            delay: 1.1,
                            width: "75vw",
                            height: "80vh",
                            scale: 1,
                            ease: "power4.inOut",
                            onComplete: () => {
                                sessionStorage.setItem("redirected", "true");
                                // Cambia aquí para que redirija solo si no es externo
                                if (!href.startsWith('http')) {
                                    window.location.assign(href);
                                }
                            }
                        });
                    }, 0);
                }
            });
        });
    },


    initPortfolioSlider() {
        console.log("Iniciando el slider del portafolio"); // Agregar log para confirmar llamada
        if ($(".cs-portfolio-slider").length) {
            $(".cs-portfolio-slider").each(function () {
                var $ttPortfolioSlider = $(this);
                var $dataSpeed = $ttPortfolioSlider.is("[data-speed]") ? $ttPortfolioSlider.data("speed") : 900;
                var $dataPaginationType = $ttPortfolioSlider.is("[data-pagination-type]") ? $ttPortfolioSlider.data("pagination-type") : "fraction";
                var $dataAutoplay = $ttPortfolioSlider.is("[data-autoplay]") ? $ttPortfolioSlider.data("autoplay") : false;
                var $dataMousewheel = $ttPortfolioSlider.is("[data-mousewheel]") ? $ttPortfolioSlider.data("mousewheel") : true;
                var $dataKeyboard = $ttPortfolioSlider.is("[data-keyboard]") ? $ttPortfolioSlider.data("keyboard") : true;
                var $dataSimulateTouch = $ttPortfolioSlider.is("[data-simulate-touch]") ? $ttPortfolioSlider.data("simulate-touch") : true;
                var $dataGrabCursor = $ttPortfolioSlider.is("[data-grab-cursor]") ? $ttPortfolioSlider.data("grab-cursor") : true;
                var $dataLoop = $ttPortfolioSlider.is("[data-loop]") ? $ttPortfolioSlider.data("loop") : true;

                var $ttPortfolioSliderSwiper = new Swiper($ttPortfolioSlider.find(".swiper")[0], {
                    direction: "vertical",
                    effect: "slide",
                    speed: $dataSpeed,
                    parallax: false,
                    resistanceRatio: 0,
                    longSwipesRatio: 0.02,
                    preloadImages: false,
                    preventInteractionOnTransition: true,
                    autoplay: $dataAutoplay,
                    mousewheel: $dataMousewheel,
                    keyboard: $dataKeyboard,
                    simulateTouch: $dataSimulateTouch,
                    grabCursor: $dataGrabCursor,
                    loop: $dataLoop,

                    breakpoints: {
                        1025: {
                            speed: 1200,
                        }
                    },

                    lazy: {
                        loadPrevNext: true,
                        loadOnTransitionStart: true,
                    },

                    navigation: {
                        nextEl: $ttPortfolioSlider.find(".cs-ps-nav-arrow-next")[0],
                        prevEl: $ttPortfolioSlider.find(".cs-ps-nav-arrow-prev")[0],
                        disabledClass: "cs-ps-nav-arrow-disabled",
                    },

                    pagination: {
                        el: $ttPortfolioSlider.find(".cs-ps-nav-pagination")[0],
                        type: $dataPaginationType,
                        modifierClass: "cs-ps-nav-pagination-",
                        dynamicBullets: true,
                        dynamicMainBullets: 1,
                        clickable: true,
                        renderBullet: function (index, className) {
                            var title = $ttPortfolioSlider.find(".swiper-slide").eq(index).data("title");
                            return '<span class="' + className + '">' + (title ? title : '') + '</span>';
                        }
                    },

                    on: {
                        init: function () {
                            var $this = this;
                            var $slideActive = $($this.slides[$this.activeIndex]);

                            $slideActive.find("video").each(function () {
                                $(this).get(0).play();
                            });

                            // Actualizar títulos, categorías, ol, y fecha
                            if ($ttPortfolioSlider.find(".cs-ps-caption-title").find("a").length) {
                                $ttPortfolioSlider.find(".cs-ps-caption-title a").text($slideActive.attr("data-title"));
                                $ttPortfolioSlider.find(".cs-ps-caption-title a").attr("href", $slideActive.attr("data-url"));
                            } else {
                                $ttPortfolioSlider.find(".cs-ps-caption-title").text($slideActive.attr("data-title"));
                            }

                            var $categoryText = $slideActive.attr("data-category").replace(/\|/g, '<br>');
                            $ttPortfolioSlider.find(".cs-ps-caption-category").html($categoryText);

                            var $olText = $slideActive.attr("data-ol");
                            $ttPortfolioSlider.find(".cs-ps-caption-ol").text($olText);

                            var $dateText = $slideActive.attr("data-date");
                            $ttPortfolioSlider.find(".cs-ps-caption-date").text($dateText);

                            setTimeout(function () {
                                if ($slideActive.hasClass("psi-image-is-light")) {
                                    $("body").addClass("psi-light-image-on");
                                } else {
                                    $("body").removeClass("psi-light-image-on");
                                }
                            }, 400);
                        },

                        transitionStart: function () {
                            var $this = this;
                            var $slideActive = $($this.slides[$this.activeIndex]);

                            setTimeout(function () {
                                if ($slideActive.hasClass("psi-image-is-light")) {
                                    $("body").addClass("psi-light-image-on");
                                } else {
                                    $("body").removeClass("psi-light-image-on");
                                }
                            }, 400);

                            $slideActive.find("video").each(function () {
                                $(this).get(0).play();
                            });

                            gsap.fromTo($ttPortfolioSlider.find(".cs-psc-elem"), { autoAlpha: 1, y: 0 }, { duration: 0.25, autoAlpha: 0, y: -30, stagger: 0.05, ease: Power1.easeIn });
                        },

                        transitionEnd: function () {
                            var $this = this;
                            var $slideActive = $($this.slides[$this.activeIndex]);

                            $slideActive.prevAll().find("video").each(function () {
                                $(this).get(0).pause();
                            });
                            $slideActive.nextAll().find("video").each(function () {
                                $(this).get(0).pause();
                            });

                            if ($ttPortfolioSlider.find(".cs-ps-caption-title").find("a").length) {
                                $ttPortfolioSlider.find(".cs-ps-caption-title a").text($slideActive.attr("data-title"));
                                $ttPortfolioSlider.find(".cs-ps-caption-title a").attr("href", $slideActive.attr("data-url"));
                            } else {
                                $ttPortfolioSlider.find(".cs-ps-caption-title").text($slideActive.attr("data-title"));
                            }

                            var $categoryText = $slideActive.attr("data-category").replace(/\|/g, '<br>');
                            $ttPortfolioSlider.find(".cs-ps-caption-category").html($categoryText);

                            var $olText = $slideActive.attr("data-ol");
                            $ttPortfolioSlider.find(".cs-ps-caption-ol").text($olText);

                            var $dateText = $slideActive.attr("data-date");
                            $ttPortfolioSlider.find(".cs-ps-caption-date").text($dateText);

                            gsap.fromTo($ttPortfolioSlider.find(".cs-psc-elem"), { autoAlpha: 0, y: 30 }, { duration: 0.25, autoAlpha: 1, y: 0, stagger: 0.05, ease: Power1.easeOut });
                        }
                    }
                });
            });
        }
    },


    removeBodyClasses() {
        const body = document.getElementById('body');
        if (body) {
        // body.classList.remove('theme-white', 'cs-transition'); // Eliminar las clases
        body.classList.remove('theme-white'); // Eliminar la clase 
        body.classList.add('theme-dark'); // Agregar la clase 'theme-dark'
        }
    },
    removeContentColor() {
        const contentColor = document.getElementById('contente-z1');
        if (contentColor) {
        contentColor.classList.remove('bg-white'); 
        contentColor.classList.add('bg-dark'); 
        }
    },
    }
};

</script>





<style scoped>
/* Estilos aquí */
</style>